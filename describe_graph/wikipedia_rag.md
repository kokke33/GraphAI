# :star:wikipedia_rag.yaml

このYAML形式のグラフは、ユーザーからの入力を受け取り、その情報に基づいてWikipediaからデータを取得し、そのデータを処理して最終的な回答を生成するためのワークフローを示しています。以下に、各ノードの役割を説明します。

1. **ループ構造**:
   - `loop`ノードは、`:continue`が真である限り繰り返し実行されることを示しています。

2. **ユーザー入力**:
   - `userInput_name`ノードは、ユーザーにトピックを入力させるためのエージェントです。コンソールに「何について知りたいですか？」というメッセージを表示します。

3. **入力チェック**:
   - `checkInput`ノードは、ユーザーの入力が「bye」でないかを確認します。このノードが続行する場合は、次に進みます。

4. **プロンプト生成**:
   - `prompt_topic`ノードと`prompt_query`ノードは、それぞれトピックに関するテンプレートメッセージを生成します。

5. **Wikipediaデータ取得**:
   - `wikipedia`ノードは、ユーザーの入力に基づいて日本語のWikipediaデータを取得します。`checkInput`ノードが真である場合にのみ実行されます。

6. **データ処理**:
   - `chunks`ノードでは、取得した記事を複数のチャンクに分割します。
   - `embeddings`ノードは、分割されたチャンクの埋め込みを取得します。
   - `topicEmbedding`ノードは、トピックの埋め込みを取得します。
   - `similarityCheck`ノードは、チャンクとトピックの埋め込みの類似性を計算します。
   - `sortedChunks`ノードは、類似性に基づいてチャンクをソートします。

7. **参照テキスト生成**:
   - `referenceText`ノードは、ソートされたチャンクから5000文字以内のテキストを生成します。

8. **プロンプトとクエリの実行**:
   - `prompt`ノードは、プロンプトと参照テキストを組み合わせて新しいプロンプトを生成します。
   - `RagQuery`ノードは、生成したプロンプトを用いてRAG（Retrieval-Augmented Generation）クエリを実行し、日本語に翻訳します。
   - `OneShotQuery`ノードは、別のプロンプトを用いてクエリを実行します。

9. **結果の取得**:
   - `RagResult`ノードと`OneShotResult`ノードは、それぞれRAGクエリとワンショットクエリの結果を取得します。

10. **最終出力**:
    - `AllResult_output`ノードは、最終的な結果を整形し、コンソールに表示します。Wikipediaからの回答とワンショットクエリの結果が含まれます。

このグラフは、ユーザーとのインタラクションを通じて情報を取得し、それを元に自然言語での回答を生成するフローを効率的に構築しています。